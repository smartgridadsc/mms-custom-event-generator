# mms-custom-event-generator

This repository contains files related to the MMS plugin found here: <https://github.com/smartgridadsc/MMS-protocol-parser-for-Zeek-IDS/>. It contains programs to auto-generate custom-events.pac file to prioritize which packets to send to the Zeek script for processing. Details of each file are described below.

1. sample.icd - This is an IED capability description file. It defines data objects that are used by an IED during communication. The data objects are organized hierarchically in this format: logical devices (LD), logical nodes (LN), data objects (DO), data attributes (DA).

2. mms_configuration_partial.csv - This is an csv file specified by the user. It contains variable names that the user wants to extract the MMS object references. The variable names can be found embedded as private blocks in the \<DA\> tags of the sample.icd file.
  
3. SCLParser.java - This is a Java program that takes the sample.icd and mms_configuration_partial.csv as inputs and outputs a user_configuration in csv format. Based on a variable name specified in the mms_configuration_partial.csv file, the program will parse the icd file to reconstruct the MMS object reference (i.e., LD/LN$FC$DO$DA). In addition to the MMS object reference, the program also stores the index position of the MMS object reference and its data type. 
  
4. EventGenerator.java - This is a Java program. It takes the user_configuration.csv generated by the SCLParser program and outputs two files namely, custom-events.pac and event_test.bif. These two files should be used in companion with the MMS plugin found at <https://github.com/smartgridadsc/MMS-protocol-parser-for-Zeek-IDS/>. The custom-events.pac file contains filtering logic to customize which MMS packets or events to send to the Zeek script. The event_test.bif contains the event declarations.
  
# Usage
  1. Run __*make*__ in the directory where you download the mms-custom-event-generator package. This command compiles the .java programs into .class executables. 
  2. Run __*java SCLParser*__ in terminal to output the user_configuration.csv file.
  3. Run __*java EventGenerator*__ in terminal to generate the custom-events.pac and event_test.bif files.
  
# Steps to integrate with MMS plugin
  1. Clone the MMS plugin from <https://github.com/smartgridadsc/MMS-protocol-parser-for-Zeek-IDS/>.
	
	git clone https://github.com/smartgridadsc/MMS-protocol-parser-for-Zeek-IDS
  2. Copy custom-events.pac and event_test.bif into the src directory of the MMS plugin.
  3. Update the mms.pac to include header files (highlighted in green) 
  
```diff
  %extern{
  	#include "events.bif.h"
+       #include "event_test.bif.h"
  %}
  ...
  %include mms-analyzer.pac
+ %include custom-events.pac
``` 
  
  4. Update the CMakeLists.txt to include the custom-events.pac and event_test.bif files (highlighted in green). Example below:

```diff
    ...
    bro_plugin_bif(src/events.bif 
+   src/event_test.bif)
    bro_plugin_pac(
    src/mms.pac 
    src/mms-analyzer.pac 
    src/mms-protocol.pac 
    src/mms-asn1.pac
+   src/custom-events.pac                              
    )
    ...
```
  5. In the mms-analyzer.pac file, uncomment the rule_function().
  6. Install the plugin following these steps. Some commands may require root privileges.
  
    cd MMS-protocol-parser-for-Zeek-IDS/
    ./configure --bro-dist=/path_to_zeek
    make
    make install
  
# Future Readings
  [1] H.C. Tan, V. Mohanraj, B. Chen, S. Nan, A. Yang, “Designing a Customizable Parser for Zeek to Analyze IEC 61850 MMS Traffic”
  
## Contact Information
If you would like to get in touch regarding our project, please contact any of our contributors via email:
1. Chen Binbin
Email: [binbin.chen@adsc-create.edu.sg](mailto:binbin.chen@adsc-create.edu.sg)
2. Tan Heng Chuan
Email: [hc.tan@adsc-create.edu.sg](mailto:hc.tan@adsc-create.edu.sg)

For more information on our organization’s research activities, please refer to our main website: [https://adsc.illinois.edu](https://adsc.illinois.edu)
  
  
